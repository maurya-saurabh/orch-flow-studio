{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "$id": "https://example.com/schemas/node-red-kg.schema.json",
    "title": "Node-RED Knowledge Graph Schema",
    "description": "Schema for Node-RED flow knowledge graph representation",
    "type": "object",
    "required": [
        "kgId",
        "componentName",
        "pathType",
        "flowId",
        "sourceFile",
        "flowType",
        "businessPurpose",
        "entryPoint",
        "exitPoint",
        "processingNodes",
        "processingFlows",
        "flowPaths",
        "metadata"
    ],
    "properties": {
        "kgId": {
            "type": "string",
            "description": "Unique identifier for the knowledge graph",
            "pattern": "^[^:]+:[^:]+::[^:]+:[^:]+$",
            "examples": [
                "Reject:INPY-RRS::RRS_Enrich_and_Validate:REJ-RET-SP-INIT",
                "Payment:INPY-VALIDATE::Validation_Flow:OUTPY-SUCCESS"
            ],
            "x-derivation-logic": [
                "Format: {Entry Flow Name}:{Entry Point}::{Exit Flow Name}:{Exit Point}",
                "Use entryPoint node name or queue reference for Entry Point",
                "Use exitPoint target or queue reference for Exit Point"
            ]
        },
        "componentName": {
            "type": "string",
            "description": "Name of the component",
            "examples": [
                "INPY-RRS_to_REJ-RET-SP-INIT",
                "INPY-VALIDATE_to_OUTPY-SUCCESS"
            ],
            "x-derivation-logic": [
                "Default Format: {entryPoint}_to_{exitPoint}",
                "Use entryPoint node name or queue reference for SourceQueue",
                "Use exitPoint target or queue reference for TargetQueue"
            ]
        },
        "pathType": {
            "type": "string",
            "description": "Type of path execution",
            "enum": [
                "HAPPY",
                "ERROR"
            ],
            "x-derivation-logic": [
                "Determine based on the nature of the flow path",
                "HAPPY for standard processing paths",
                "ERROR for exception or error handling paths i.e. Exit Point is an error queue"
            ]
        },
        "flowId": {
            "type": "string",
            "description": "Identifier of the flow",
            "examples": [
                "efbd9c2a.22c8c",
                "a1b2c3d4.e5f6g7"
            ],
            "x-derivation-logic": [
                "Use the unique flow ID from the Node-RED flow JSON",
                "Typically found in the 'id' field of the flow object"
            ]
        },
        "sourceFile": {
            "type": "string",
            "description": "Name of the flow file containing the implementation",
            "examples": [
                "Technical_Responses_and_ARS.json",
                "Payment_Validation_Flow.json"
            ],
            "x-derivation-logic": [
                "Use the filename of Node-RED flow JSON file containing the entry point node"
            ]
        },
        "flowType": {
            "type": "string",
            "description": "Type of flow structure",
            "enum": [
                "FLOW",
                "SUBFLOW"
            ],
            "x-derivation-logic": [
                "Determine based on whether the entry point is a main flow or a subflow",
                "FLOW if entry point is in a main Node-RED flow",
                "SUBFLOW if entry point is in a Node-RED subflow"
            ]
        },
        "businessPurpose": {
            "type": "string",
            "description": "Business purpose and description of the flow's functionality",
            "x-derivation-logic": [
                "Summarize the business functionality implemented by the flow",
                "Include key processing steps and objectives achieved by the flow",
                "Will be generated by LLM based on flow analysis"
            ]
        },
        "entryPoint": {
            "type": "object",
            "description": "Entry point of the flow - can be either a node or a connector",
            "oneOf": [
                {
                    "required": [
                        "node"
                    ],
                    "properties": {
                        "node": {
                            "$ref": "common-specs.json#/definitions/nodeReference"
                        }
                    },
                    "additionalProperties": false
                },
                {
                    "required": [
                        "connector"
                    ],
                    "properties": {
                        "connector": {
                            "$ref": "common-specs.json#/definitions/connectorReference"
                        }
                    },
                    "additionalProperties": false
                }
            ]
        },
        "exitPoint": {
            "type": "object",
            "description": "Exit point of the flow - can be either a node or a connector",
            "oneOf": [
                {
                    "required": [
                        "node"
                    ],
                    "properties": {
                        "node": {
                            "$ref": "common-specs.json#/definitions/nodeReference"
                        }
                    },
                    "additionalProperties": false
                },
                {
                    "required": [
                        "connector"
                    ],
                    "properties": {
                        "connector": {
                            "$ref": "common-specs.json#/definitions/connectorReference"
                        }
                    },
                    "additionalProperties": false
                }
            ]
        },
        "processingNodes": {
            "type": "array",
            "description": "List of processing nodes in the flow",
            "items": {
                "$ref": "common-specs.json#/definitions/nodeReference"
            }
        },
        "processingFlows": {
            "type": "array",
            "description": "List of sub-flows or nested flows within the main flow",
            "items": {
                "$ref": "common-specs.json#/definitions/flowReference"
            }
        },
        "flowPaths": {
            "type": "object",
            "description": "Collection of execution paths through the flow",
            "patternProperties": {
                "^path_[0-9]+$": {
                    "type": "array",
                    "description": "Sequence of steps in a flow path",
                    "items": {
                        "$ref": "common-specs.json#/definitions/pathStep"
                    }
                }
            },
            "additionalProperties": false
        },
        "metadata": {
            "$ref": "metadata-schema-spec.json#"
        }
    }
}
