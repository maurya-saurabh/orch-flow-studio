{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "$id": "https://example.com/schemas/node-kg.schema.json",
    "title": "Node Knowledge Graph Schema",
    "description": "Schema for individual node knowledge graph representation",
    "type": "object",
    "required": [
        "nodeKgId",
        "nodeName",
        "category",
        "functionName",
        "sourceFile",
        "businessLogic",
        "parameters",
        "inputs",
        "referenced",
        "output",
        "errorConstants"
    ],
    "properties": {
        "nodeKgId": {
            "type": "string",
            "pattern": "TODO",
            "description": "Unique knowledge graph identifier for the node",
            "examples": [
                "oepy-payments::map-iso-to-rjct-po",
                "oepy-schm-cofig::fetch-orig-payment-details",
                "oepy-payments::validate-payment-data"
            ],
            "x-derivation-logic": [
                "Format: <repositoryName>::<nodeName>",
                "Use kebab-case naming convention",
                "Must be unique within the component library"
            ]
        },
        "nodeName": {
            "type": "string",
            "description": "Unique identifier name for the node",
            "examples": [
                "map-iso-to-rjct-po",
                "fetch-orig-payment-details",
                "validate-payment-data"
            ],
            "x-derivation-logic": [
                "Use kebab-case naming convention",
                "use the name of the node as defined in the library"
            ]
        },
        "category": {
            "type": "string",
            "description": "Functional category or domain of the node",
            "examples": [
                "PaymentOrder",
                "CP",
                "SP"
            ],
            "x-derivation-logic": [
                "Categorize based on primary business domain",
                "It should be taken from node's html category tag"
            ]
        },
        "functionName": {
            "type": "string",
            "description": "Name of the actual function or method implementing the node logic",
            "examples": [
                "mapJsonObjectsRjctPo",
                "fetchOriginalPaymentDetails",
                "validatePaymentStructure"
            ],
            "x-derivation-logic": [
                "Extract from the actual function name in the source code"
            ]
        },
        "sourceFile": {
            "type": "string",
            "description": "Name of the source file containing the implementation",
            "examples": [
                "JsonMapper.js",
                "PaymentValidator.js",
                "DataEnricher.js"
            ],
            "x-derivation-logic": [
                "Include file extension",
                "Should be the actual filename in the codebase",
                "Path relative to the library root if needed"
            ]
        },
        "businessLogic": {
            "type": "string",
            "description": "Detailed description of the business logic and functionality implemented by the node",
            "x-derivation-logic": [
                "Provide comprehensive description of what the node does",
                "Include key processing steps and business rules",
                "Explain the purpose and expected outcomes",
                "Will be generated by LLM based on code analysis"
            ]
        },
        "parameters": {
            "type": "array",
            "description": "List of input parameters required by the node",
            "items": {
                "type": "string"
            },
            "examples": [
                [
                    "inputMessage",
                    "mappingConfig"
                ],
                [
                    "inputMessage"
                ]
            ],
            "x-derivation-logic": [
                "Extract from function signature or node definition",
                "List all input parameters",
                "Use parameter names as they appear in the code"
            ]
        },
        "inputs": {
            "type": "array",
            "description": "List of input data models and their properties used by this node",
            "items": {
                "$ref": "common-specs.json#/definitions/modelReference",
                "required": [
                    "referencedProperties"
                ]
            },
            "x-derivation-logic": [
                "Identify models and fields that are consumed as input by the node",
                "Reference the schema definition of the input model",
                "List all properties that are used from each input model"
            ]
        },
        "referenced": {
            "type": "object",
            "description": "External services and internal databases referenced by this node",
            "properties": {
                "api": {
                    "type": "array",
                    "description": "External APIs referenced or called by this node",
                    "items": {
                        "$ref": "common-specs.json#/definitions/contractReference"
                    }
                },
                "db": {
                    "type": "array",
                    "description": "Database entities and its attributes referenced by this node",
                    "items": {
                        "$ref": "common-specs.json#/definitions/modelReference",
                        "required": [
                            "referencedProperties"
                        ]
                    }
                }
            },
            "additionalProperties": false,
            "x-derivation-logic": [
                "Identify all external API calls and database operations",
                "Use contract references to API and Model reference to database specifications",
                "Include only read operations"
            ]
        },
        "outputs": {
            "type": "object",
            "description": "Output data models and internal database models produced or enriched by this node",
            "properties": {
                "returnModels": {
                    "type": "array",
                    "description": "Data models returned by this node",
                    "items": {
                        "$ref": "common-specs.json#/definitions/modelReference",
                        "required": [
                            "enrichedProperties"
                        ]
                    }
                },
                "db": {
                    "type": "array",
                    "description": "Internal database entities written or enriched by this node",
                    "items": {
                        "$ref": "common-specs.json#/definitions/modelReference",
                        "required": [
                            "enrichedProperties"
                        ]
                    }
                }
            },
            "additionalProperties": false,
            "x-derivation-logic": [
                "Identify models returned by the node function",
                "Document database write operations and affected entities",
                "Reference schema definitions of output models"
            ]
        },
        "errorConstants": {
            "type": "array",
            "description": "List of error constants or error codes that can be thrown by this node",
            "items": {
                "type": "string",
                "pattern": "^[A-Z][A-Z0-9_]*[A-Z0-9]$"
            },
            "examples": [
                [
                    "MAPPER_DERIVATION_FAILED",
                    "MAPPING_NOT_SUCCESSFUL",
                    "INVALID_INPUT_FORMAT"
                ]
            ],
            "x-derivation-logic": [
                "Extract error constants from code",
                "Include all possible error conditions",
                "Use UPPER_SNAKE_CASE naming convention",
                "Document error scenarios that can occur"
            ]
        },
        "metadata": {
            "$ref": "metadata-schema-spec.json#",
            "description": "Metadata about the knowledge graph generation"
        }
    }
}
